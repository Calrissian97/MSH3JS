<!DOCTYPE html>
<html lang="en">

<head>
  <title>MSH3JS MSH file viewer</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA metadata, icon -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="favicon.ico" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">

  <!-- Not much styling, just use inline -->
  <style>
    @font-face {
      font-family: 'Aurebesh';
      src: url('./Aurebesh.ttf') format('truetype');
    }

    html,
    body {
      margin: 0;
      width: 100%;
      height: 100%;
      background-color: rgb(0, 0, 0);
      scrollbar-width: none;
    }

    #app {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    canvas {
      display: block;
      scrollbar-width: none;
      position: relative;
      padding: 0;
      margin: 0;
    }

    :root {
      --tp-font-family: sans-serif;
      --tp-base-background-color: hsla(0, 0%, 0%, 0.80);
      --tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);
      --tp-button-background-color: hsla(0, 0%, 70%, 1.0);
      --tp-button-background-color-active: hsla(0, 0%, 85%, 0.80);
      --tp-button-background-color-focus: hsla(0, 0%, 80%, 0.80);
      --tp-button-background-color-hover: hsla(0, 0%, 75%, 0.80);
      --tp-button-foreground-color: hsla(0, 0%, 0%, 1.00);
      --tp-container-background-color: hsla(0, 0%, 10%, 0.80);
      --tp-container-background-color-active: hsla(0, 0%, 25%, 0.80);
      --tp-container-background-color-focus: hsla(0, 0%, 20%, 0.80);
      --tp-container-background-color-hover: hsla(0, 0%, 15%, 0.80);
      --tp-container-foreground-color: hsla(0, 0%, 80%, 1.00);
      --tp-groove-foreground-color: hsla(0, 0%, 10%, 1.00);
      --tp-input-background-color: hsla(0, 0%, 10%, 0.90);
      --tp-input-background-color-active: hsla(0, 0%, 25%, 0.90);
      --tp-input-background-color-focus: hsla(0, 0%, 20%, 0.90);
      --tp-input-background-color-hover: hsla(0, 0%, 15%, 0.90);
      --tp-input-foreground-color: hsla(0, 0%, 80%, 1.00);
      --tp-label-foreground-color: hsla(0, 0%, 80%, 1.00);
      --tp-monitor-background-color: hsla(0, 0%, 8%, 0.90);
      --tp-monitor-foreground-color: hsla(0, 0%, 80%, 1.00);
    }

    /* Force selected font on Tweakpane elements */
    #tweakpaneContainer {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1;
      width: 290px;
      /* Define a variable for the font, defaulting to Orbitron */
      --tweakpane-font: "Orbitron";
    }

    #tweakpaneContainer * {
      font-family: var(--tweakpane-font), sans-serif;
    }

    #loading-container {
      position: absolute;
      bottom: 30px;
      right: 30px;
      display: none;
      /* Hidden by default, will be set to 'flex' by JS */
      z-index: 2;
      align-items: center;
      color: #FFFFFF;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 1px 1px 2px black;
    }

    #loading-text {
      margin-right: 10px;
      font-size: 1em;
    }

    .loading-sphere {
      display: inline-block;
      width: 15px;
      height: 15px;
      background-color: #648FFF;
      /* A nice light blue */
      border-radius: 50%;
      margin: 0 4px;
      opacity: 0.2;
      /* Initially dim */
      transition: opacity 0.9s ease;
    }

    /* Custom scrollbar for Tweakpane root container */
    .tp-rotv::-webkit-scrollbar {
      width: 8px;
    }

    .tp-rotv::-webkit-scrollbar-track {
      background: var(--tp-input-background-color, #1a1a1a);
      border-radius: 4px;
    }

    .tp-rotv::-webkit-scrollbar-thumb {
      background-color: var(--tp-container-foreground-color, #808080);
      border-radius: 4px;
      border: 2px solid var(--tp-input-background-color, #1a1a1a);
    }

    .tp-rotv::-webkit-scrollbar-thumb:hover {
      background-color: var(--tp-button-background-color, #999999);
    }
  </style>
</head>

<body>
  <!-- Imports for msh3js -->
  <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.151.0/build/three.module.min.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.151.0/examples/jsm/",
          "webgl-lint": "https://cdn.jsdelivr.net/npm/webgl-lint/webgl-lint.min.js",
          "stats-gl": "https://cdn.jsdelivr.net/npm/stats-gl/dist/main.min.js",
          "tweakpane": "https://cdn.jsdelivr.net/npm/tweakpane/dist/tweakpane.min.js",
          "tweakpane-plugin-html-color-picker": "https://cdn.jsdelivr.net/npm/tweakpane-plugin-html-color-picker/dist/tweakpane-plugin-html-color-picker.min.js",
          "view-helper": "./ViewHelper.js",
          "three-mesh-bvh": "https://cdn.jsdelivr.net/npm/three-mesh-bvh@0.6.8/build/index.module.min.js",
          "MSHLoader": "./MSHLoader.js",
          "msh3js": "./msh3js.js"
        }
      }
    </script>

  <!-- Canvas to render .msh file -->
  <div id="app">
    <canvas id="msh3jsCanvas" width="1" height="1"></canvas>
  </div>

  <!-- App entry (ESM) -->
  <script type="module">
    // App object/namespace for application state and data
    import msh3js from "msh3js";
    // When HTML is loaded...
    document.addEventListener("DOMContentLoaded", async () => {
      if (msh3js.debug) console.log("HTML loaded");
      // Get canvas element
      const canvas = document.getElementById("msh3jsCanvas");
      // Set app options
      const options = {
        AA: null, // {boolean} Enable/disable anti-aliasing. Overrides sampleCount if set to false.
        AAsampleCount: null, // {number} Desired anti-aliasing sample count (e.g., 0, 2, 4, 8). 0 disables AA.
        // Note: Will be adjusted to the closest supported value for the chosen rendering API.
        ambLightColor: null, // {string} Hex color string for the ambient light (e.g., "#4d4d4d").
        ambLightIntensity: null, // {number} Intensity of the ambient light (e.g., 1.0).
        autoRotate: null, // {boolean} Enable/disable automatic rotation of the camera.
        autoRotateSpeed: null, // {number} Speed of auto-rotation (e.g., 0.5).
        backgroundColor: null, // {string} Hex color string for the scene background (e.g., "#000000").
        backgroundImage: null, // {string} URL or path to a background image (e.g., "test.png").
        /* bloom: {
          enabled: null, // {boolean} Enable/disable bloom
          threshold: null, // {number} Threshold for bloom (0.0 - 1.0).
          strength: null, // {number} Strength of bloom (0.0 - 3.0).
          radius: null, // {number} Radius of bloom (0.0 - 1.0).
        }, */
        /* cloth: {
          enabled: null, // {boolean} Enable/disable cloth simulations.
          windSpeed: null, // {number} Speed of the wind affecting cloth (0.0 - 10.0).
          windDirection: null, // {number} Direction of the wind in degrees (0 - 360).
        }, */
        controlDamping: null, // {boolean} Enable/disable damping for camera controls.
        /* dirLight1: {
          color: null, // {string} Hex color string for the primary directional light.
          intensity: null, // {number} Intensity of the primary directional light.
          azimuth: null, // {number} Azimuth angle in degrees (0 - 360) for primary light direction.
          elevation: null, // {number} Elevation angle in degrees (-90 - 90) for primary light direction.
        }, */
        /* dirLight2: {
          color: null, // {string} Hex color string for the secondary directional light.
          intensity: null, // {number} Intensity of the secondary directional light.
          azimuth: null, // {number} Azimuth angle in degrees (0 - 360) for secondary light direction.
          elevation: null, // {number} Elevation angle in degrees (-90 - 90) for secondary light direction.
        }, */
        displayHelpers: null, // {boolean} If true, enables dirLight, dirLight2, ViewHelper, Grid, and Skeleton helpers.
        displayShadows: null, // {boolean} Enable/disable shadows.
        displayStats: null, // {boolean} Show/hide the performance stats panel.
        displayTweakpane: null, // {boolean} Show/hide the Tweakpane UI.
        GPU: null, // {string} "default", "low-power", or "high-performance".
        pixelRatio: null, // {number} Device pixel ratio multiplier (e.g., 1.0, 2.0).
        renderingAPI: null, // {string} "webgl" or "webgl2". Will fall back if not supported.
        tweakpaneFont: null, // {string} Font family name for Tweakpane (e.g., "Orbitron", "Aurebesh", "sans-serif").
        /* viewHelperColors: {
          x: null, // {number} Hex color for the X-axis (e.g., 0xAA0000).
          y: null, // {number} Hex color for the Y-axis (e.g., 0x00AA00).
          z: null, // {number} Hex color for the Z-axis (e.g., 0x0000AA).
        }, */
        /* xr: {
          AR: null, // {boolean} Enable/disable Augmented Reality (AR) viewing. (Currently disabled for testing)
          VR: null, // {boolean} Enable/disable Virtual Reality (VR) viewing. (Currently disabled for testing)
        }, */
        /* size: {
          width: null, // {string} CSS width value for the app container (e.g., "100%", "800px").
          height: null, // {string} CSS height value for the app container (e.g., "100%", "600px").
        }, */
        urls: null, // {Array<string>} An array of URLs to MSH, TGA, or msh.option files to load.
      };
      // Start App loop
      await msh3js.startApp(canvas, options);
    });
  </script>

  <!-- Fallback app entry (UMD) -->
  <!-- Dependencies for the UMD build -->
  <script nomodule defer src="https://cdn.jsdelivr.net/npm/three@0.151.0/build/three.min.js"></script>
  <script nomodule defer
    src="https://cdn.jsdelivr.net/npm/three@0.151.0/examples/js/controls/OrbitControls.js"></script>
  <script nomodule defer src="https://cdn.jsdelivr.net/npm/three@0.151.0/examples/js/loaders/TGALoader.js"></script>
  <script nomodule defer src="https://cdn.jsdelivr.net/npm/stats-gl/dist/main.min.js"></script>
  <script nomodule defer src="https://cdn.jsdelivr.net/npm/tweakpane@3/dist/tweakpane.min.js"></script>
  <!-- Use tweakpane v3 for umd builds -->
  <script nomodule defer
    src="https://cdn.jsdelivr.net/npm/tweakpane-plugin-html-color-picker/dist/tweakpane-plugin-html-color-picker.umd.min.js"></script>
  <script nomodule defer src="https://cdn.jsdelivr.net/npm/webgl-lint/webgl-lint.min.js"></script>
  <script nomodule defer src="https://cdn.jsdelivr.net/npm/three-mesh-bvh@0.4.0/build/index.umd.min.js"></script>
  <script nomodule defer src="./msh3js.umd.js"></script>
  <script nomodule defer src="./MSHLoader.umd.js"></script>
  <script nomodule defer src="./ViewHelper.umd.js"></script>
  <script nomodule defer>
    // Fallback to UMD for browsers that don't support ESM
    document.addEventListener("DOMContentLoaded", async () => {
      if (window.msh3js) {
        // Start app
        if (window.msh3js.debug) console.log("HTML loaded (nomodule)");
        const canvas = document.getElementById("msh3jsCanvas");
        const options = {};
        await window.msh3js.startApp(canvas, options);
      } else {
        console.error("msh3js is not defined. Your browser may not be supported or the UMD bundle failed to load.");
        const appContainer = document.getElementById('msh3js') || document.getElementById('app') || document.body;
        if (appContainer) {
          // Warn user of unsupported browser and required features
          appContainer.style.cssText = 'display: flex; align-items: center; justify-content: center; height: 100%;';
          appContainer.innerHTML = '<p style="color: white; font-family: sans-serif; text-align: center; padding: 2em;">Your browser is not supported.<br>This application requires a browser that supports WebGL and JavaScript.</p>';
        }
      }
    });
  </script>
  <!-- Message for browsers with JavaScript disabled -->
  <noscript>
    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
      <p style="color: white; font-family: sans-serif; text-align: center; padding: 2em;">
        This application requires JavaScript to be enabled.
        <br>Please enable JavaScript in your browser settings and refresh the page.
      </p>
    </div>
  </noscript>
</body>

</html>